<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password - MoneyPilot</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <h1>MoneyPilot</h1>
            </div>
            <nav>
                <a href="index.html">Home</a>
                <a href="login.html">Login</a>
                <a href="register.html">Register</a>
            </nav>
        </div>
    </header>

    <div class="form-container">
        <h2>Reset Your Password</h2>
        
        <div class="reset-steps">
            <div class="step active" id="step1">
                <h3>Step 1: Enter Your Email</h3>
                <form id="resetRequestForm">
                    <div class="form-group">
                        <label for="resetEmail">Email Address</label>
                        <input type="email" id="resetEmail" name="email" required 
                               placeholder="Enter your registered email address">
                    </div>
                    <button type="submit" class="btn-submit">Send Reset Code</button>
                </form>
            </div>

            <div class="step" id="step2">
                <h3>Step 2: Enter Verification Code</h3>
                <form id="verifyCodeForm">
                    <div class="form-group">
                        <label for="resetCode">Verification Code</label>
                        <input type="text" id="resetCode" name="code" required 
                               placeholder="Enter 6-digit code sent to your email">
                    </div>
                    <button type="submit" class="btn-submit">Verify Code</button>
                </form>
                <div class="resend-code">
                    <p>Didn't receive the code? <a href="#" id="resendCode">Resend Code</a></p>
                </div>
            </div>

            <div class="step" id="step3">
                <h3>Step 3: Set New Password</h3>
                <form id="newPasswordForm">
                    <div class="form-group">
                        <label for="newPassword">New Password</label>
                        <input type="password" id="newPassword" name="password" required 
                               minlength="6" placeholder="Enter your new password">
                        <small>Password must be at least 6 characters long</small>
                    </div>
                    <div class="form-group">
                        <label for="confirmNewPassword">Confirm New Password</label>
                        <input type="password" id="confirmNewPassword" name="confirmPassword" required 
                               placeholder="Confirm your new password">
                    </div>
                    <button type="submit" class="btn-submit">Reset Password</button>
                </form>
            </div>

            <div class="step" id="step4">
                <div class="success-message">
                    <div class="success-icon">âœ…</div>
                    <h3>Password Reset Successful!</h3>
                    <p>Your password has been reset successfully. You can now login with your new password.</p>
                    <a href="login.html" class="btn-submit">Go to Login</a>
                </div>
            </div>
        </div>

        <div class="form-links">
            <p>Remember your password? <a href="login.html">Back to Login</a></p>
        </div>

        <div class="support-info">
            <h4>Need Help?</h4>
            <p>If you're having trouble resetting your password, contact our support team:</p>
            <ul>
                <li>Email: admin@moneypilot.site</li>
                <li>WhatsApp: <a href="https://chat.whatsapp.com/BR2lDg9u5v378KB4SE5XnU" target="_blank">Join our Support Group</a></li>
            </ul>
        </div>
    </div>

    <script>
        class PasswordReset {
            constructor() {
                this.currentStep = 1;
                this.resetEmail = '';
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.showStep(1);
            }

            setupEventListeners() {
                // Step 1: Request reset code
                document.getElementById('resetRequestForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.requestResetCode();
                });

                // Step 2: Verify code
                document.getElementById('verifyCodeForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.verifyResetCode();
                });

                // Step 3: Set new password
                document.getElementById('newPasswordForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.setNewPassword();
                });

                // Resend code
                document.getElementById('resendCode').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.resendCode();
                });
            }

            showStep(stepNumber) {
                // Hide all steps
                document.querySelectorAll('.step').forEach(step => {
                    step.classList.remove('active');
                });
                
                // Show current step
                document.getElementById(`step${stepNumber}`).classList.add('active');
                this.currentStep = stepNumber;
            }

            requestResetCode() {
                const email = document.getElementById('resetEmail').value;
                
                // Simple validation
                if (!this.isValidEmail(email)) {
                    alert('Please enter a valid email address');
                    return;
                }

                // In a real application, this would send an actual email
                // For demo purposes, we'll simulate this
                this.resetEmail = email;
                
                // Generate a random 6-digit code
                this.verificationCode = Math.floor(100000 + Math.random() * 900000).toString();
                
                // Simulate sending email
                console.log(`Reset code for ${email}: ${this.verificationCode}`); // For demo purposes
                
                alert(`A verification code has been sent to ${email}. For demo purposes, use code: ${this.verificationCode}`);
                
                this.showStep(2);
            }

            verifyResetCode() {
                const enteredCode = document.getElementById('resetCode').value;
                
                if (enteredCode === this.verificationCode) {
                    this.showStep(3);
                } else {
                    alert('Invalid verification code. Please try again.');
                }
            }

            setNewPassword() {
                const newPassword = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmNewPassword').value;

                // Validate passwords
                if (newPassword.length < 6) {
                    alert('Password must be at least 6 characters long');
                    return;
                }

                if (newPassword !== confirmPassword) {
                    alert('Passwords do not match');
                    return;
                }

                // In a real application, this would update the password in the database
                // For demo purposes, we'll just show success
                
                // Update password in localStorage (for demo)
                this.updatePasswordInStorage(newPassword);
                
                this.showStep(4);
            }

            updatePasswordInStorage(newPassword) {
                try {
                    const users = JSON.parse(localStorage.getItem('moneyPilotUsers')) || [];
                    const userIndex = users.findIndex(user => user.email === this.resetEmail);
                    
                    if (userIndex !== -1) {
                        // Simple hash for demo (in real app use proper hashing)
                        users[userIndex].password = btoa(newPassword);
                        localStorage.setItem('moneyPilotUsers', JSON.stringify(users));
                    }
                } catch (error) {
                    console.log('Demo: Password update simulated');
                }
            }

            resendCode() {
                if (!this.resetEmail) {
                    alert('Please enter your email first');
                    this.showStep(1);
                    return;
                }

                // Generate new code
                this.verificationCode = Math.floor(100000 + Math.random() * 900000).toString();
                
                // Simulate resending email
                console.log(`New reset code for ${this.resetEmail}: ${this.verificationCode}`);
                
                alert(`A new verification code has been sent to ${this.resetEmail}. For demo purposes, use code: ${this.verificationCode}`);
                
                // Clear the code input field
                document.getElementById('resetCode').value = '';
            }

            isValidEmail(email) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return emailRegex.test(email);
            }
        }

        // Initialize password reset system
        document.addEventListener('DOMContentLoaded', () => {
            new PasswordReset();
        });
    </script>

    <style>
        .reset-steps {
            margin-bottom: 2rem;
        }

        .step {
            display: none;
        }

        .step.active {
            display: block;
        }

        .step h3 {
            color: #2c5aa0;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .resend-code {
            text-align: center;
            margin-top: 1rem;
        }

        .resend-code a {
            color: #2c5aa0;
            text-decoration: none;
        }

        .success-message {
            text-align: center;
            padding: 2rem;
        }

        .success-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .success-message h3 {
            color: #00d9a6;
            margin-bottom: 1rem;
        }

        .success-message p {
            color: #666;
            margin-bottom: 2rem;
        }

        .support-info {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
            margin-top: 2rem;
        }

        .support-info h4 {
            color: #2c5aa0;
            margin-bottom: 1rem;
        }

        .support-info ul {
            margin: 1rem 0;
            padding-left: 1.5rem;
        }

        .support-info li {
            margin-bottom: 0.5rem;
        }

        .support-info a {
            color: #2c5aa0;
            text-decoration: none;
        }

        @media (max-width: 768px) {
            .form-container {
                margin: 100px 20px 50px;
            }

            .success-icon {
                font-size: 3rem;
            }
        }
    </style>
</body>
</html>